<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonSynth Pro - Retro Synthesizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap');
        
        :root {
            --neon-pink: #ff0080;
            --neon-blue: #00ffff;
            --neon-purple: #8a2be2;
            --neon-green: #39ff14;
            --neon-orange: #ff6600;
            --dark-bg: #0a0a0a;
            --panel-bg: #1a1a1a;
            --metal-bg: #2a2a2a;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 50%, #0a1a1a 100%);
            min-height: 100vh;
            overflow-x: auto;
        }

        .neon-glow {
            text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor, 0 0 20px currentColor;
        }

        .box-glow {
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3), 0 0 20px rgba(255, 0, 128, 0.2), 0 0 30px rgba(255, 0, 128, 0.1);
        }

        .grid-bg {
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .knob {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #4a4a4a, #1a1a1a);
            border: 2px solid #333;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .knob:hover {
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .knob.active {
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.8);
            border-color: var(--neon-pink);
        }

        .knob::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 20px;
            background: var(--neon-blue);
            border-radius: 2px;
            box-shadow: 0 0 5px var(--neon-blue);
            transition: all 0.2s ease;
        }

        .knob.active::before {
            background: var(--neon-pink);
            box-shadow: 0 0 10px var(--neon-pink);
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: #333;
            outline: none;
            border-radius: 2px;
            transition: all 0.2s ease;
        }

        .slider:hover {
            background: #444;
        }

        .slider.active {
            background: linear-gradient(to right, var(--neon-pink), var(--neon-blue));
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.5);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--neon-pink);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--neon-pink);
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px var(--neon-pink);
        }

        .led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            transition: all 0.3s ease;
        }

        .led.active {
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green);
        }

        .oscilloscope {
            background: #000;
            border: 2px solid #333;
            position: relative;
            overflow: hidden;
        }

        .waveform {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--neon-green);
            box-shadow: 0 0 5px var(--neon-green);
            animation: wave 2s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0) scaleX(1); }
            25% { transform: translateY(-20px) scaleX(1.1); }
            50% { transform: translateY(0) scaleX(0.9); }
            75% { transform: translateY(20px) scaleX(1.1); }
        }

        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue);
            animation: scan 3s linear infinite;
        }

        @keyframes scan {
            0% { left: 0; }
            100% { left: 100%; }
        }

        .key {
            height: 120px;
            cursor: pointer;
            transition: all 0.1s ease;
            position: relative;
        }

        .key.white {
            background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
            border: 1px solid #999;
        }

        .key.black {
            background: linear-gradient(to bottom, #2a2a2a, #1a1a1a);
            height: 80px;
            width: 60%;
            z-index: 2;
            border: 1px solid #000;
        }

        .key:active, .key.pressed {
            transform: translateY(2px);
            box-shadow: inset 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .key.playing {
            box-shadow: 0 0 20px var(--neon-blue), inset 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .panel {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 1px solid #444;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .display {
            background: #000;
            color: var(--neon-green);
            font-family: 'Orbitron', monospace;
            border: 2px solid #333;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
        }

        .spectrum-bar {
            background: linear-gradient(to top, var(--neon-pink), var(--neon-blue));
            width: 4px;
            margin: 0 1px;
            transition: height 0.1s ease;
            box-shadow: 0 0 5px currentColor;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .button-active {
            background: linear-gradient(145deg, var(--neon-purple), var(--neon-pink)) !important;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.6);
            transform: scale(0.98);
        }
    </style>
</head>
<body class="text-white">
    <!-- Header -->
    <header class="relative p-6 border-b border-gray-700">
        <div class="grid-bg absolute inset-0 opacity-20"></div>
        <div class="relative z-10 flex flex-col md:flex-row items-center justify-between">
            <h1 class="text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 neon-glow mb-4 md:mb-0" style="font-family: 'Orbitron', monospace;">
                NEONSYNTH PRO
            </h1>
            <div class="flex items-center space-x-4">
                <div class="led active"></div>
                <span class="text-cyan-400 font-semibold">POWER</span>
                <div class="display px-4 py-2 rounded">
                    <span class="text-lg font-mono" id="frequency-display">440 Hz</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Synthesizer Interface -->
    <main class="p-4 md:p-8">
        <!-- Oscilloscope and Spectrum Analyzer -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Oscilloscope -->
            <div class="panel p-6 rounded-lg">
                <h3 class="text-xl font-bold text-cyan-400 mb-4 flex items-center">
                    <div class="led active mr-2"></div>
                    OSCILLOSCOPE
                </h3>
                <div class="oscilloscope h-48 rounded grid-bg relative">
                    <canvas id="oscilloscope-canvas" width="400" height="192" class="absolute inset-0 w-full h-full"></canvas>
                    <div class="scan-line"></div>
                </div>
                <div class="flex justify-between mt-4 text-sm text-gray-400">
                    <span>TIME: 1ms/div</span>
                    <span>AMPL: 2V/div</span>
                </div>
            </div>

            <!-- Spectrum Analyzer -->
            <div class="panel p-6 rounded-lg">
                <h3 class="text-xl font-bold text-pink-400 mb-4 flex items-center">
                    <div class="led active mr-2"></div>
                    SPECTRUM ANALYZER
                </h3>
                <div class="h-48 bg-black rounded flex items-end justify-center p-4">
                    <div class="flex items-end h-full space-x-1" id="spectrum">
                        <!-- Spectrum bars will be generated by JavaScript -->
                    </div>
                </div>
                <div class="flex justify-between mt-4 text-sm text-gray-400">
                    <span>20Hz</span>
                    <span>1kHz</span>
                    <span>20kHz</span>
                </div>
            </div>
        </div>

        <!-- Control Panels -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Oscillator Section -->
            <div class="panel p-6 rounded-lg">
                <h3 class="text-lg font-bold text-purple-400 mb-4 border-b border-gray-600 pb-2">OSCILLATOR</h3>
                <div class="space-y-4">
                    <div class="text-center">
                        <label class="block text-sm text-gray-300 mb-2">FREQUENCY</label>
                        <div class="knob mx-auto" data-param="frequency" data-value="440"></div>
                        <span class="block text-xs text-cyan-400 mt-1" id="freq-label">440 Hz</span>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-300 mb-2">WAVEFORM</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button class="waveform-btn bg-gray-700 hover:bg-purple-600 px-3 py-2 rounded text-xs transition-all" data-waveform="sine">SINE</button>
                            <button class="waveform-btn bg-gray-700 hover:bg-purple-600 px-3 py-2 rounded text-xs transition-all" data-waveform="sawtooth">SAW</button>
                            <button class="waveform-btn bg-gray-700 hover:bg-purple-600 px-3 py-2 rounded text-xs transition-all" data-waveform="square">SQUARE</button>
                            <button class="waveform-btn bg-gray-700 hover:bg-purple-600 px-3 py-2 rounded text-xs transition-all" data-waveform="noise">NOISE</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="panel p-6 rounded-lg">
                <h3 class="text-lg font-bold text-cyan-400 mb-4 border-b border-gray-600 pb-2">FILTER</h3>
                <div class="space-y-4">
                    <div class="text-center">
                        <label class="block text-sm text-gray-300 mb-2">CUTOFF</label>
                        <div class="knob mx-auto" data-param="cutoff" data-value="1000"></div>
                        <span class="block text-xs text-cyan-400 mt-1" id="cutoff-label">1.0 kHz</span>
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-300 mb-2">RESONANCE</label>
                        <div class="knob mx-auto" data-param="resonance" data-value="1"></div>
                        <span class="block text-xs text-cyan-400 mt-1" id="resonance-label">1.0</span>
                    </div>
                </div>
            </div>

            <!-- Envelope Section -->
            <div class="panel p-6 rounded-lg">
                <h3 class="text-lg font-bold text-pink-400 mb-4 border-b border-gray-600 pb-2">ENVELOPE</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-xs text-gray-300 mb-1">ATTACK</label>
                        <input type="range" class="slider w-full" data-param="attack" min="0" max="100" value="20">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-300 mb-1">DECAY</label>
                        <input type="range" class="slider w-full" data-param="decay" min="0" max="100" value="30">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-300 mb-1">SUSTAIN</label>
                        <input type="range" class="slider w-full" data-param="sustain" min="0" max="100" value="70">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-300 mb-1">RELEASE</label>
                        <input type="range" class="slider w-full" data-param="release" min="0" max="100" value="40">
                    </div>
                </div>
            </div>

            <!-- Effects Section -->
            <div class="panel p-6 rounded-lg">
                <h3 class="text-lg font-bold text-orange-400 mb-4 border-b border-gray-600 pb-2">EFFECTS</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm">REVERB</span>
                        <div class="led" id="reverb-led"></div>
                    </div>
                    <input type="range" class="slider w-full" data-param="reverb" min="0" max="100" value="25">
                    <div class="flex items-center justify-between">
                        <span class="text-sm">DELAY</span>
                        <div class="led" id="delay-led"></div>
                    </div>
                    <input type="range" class="slider w-full" data-param="delay" min="0" max="100" value="15">
                    <div class="flex items-center justify-between">
                        <span class="text-sm">CHORUS</span>
                        <div class="led" id="chorus-led"></div>
                    </div>
                    <input type="range" class="slider w-full" data-param="chorus" min="0" max="100" value="35">
                </div>
            </div>
        </div>

        <!-- Virtual Keyboard -->
        <div class="panel p-6 rounded-lg mb-8">
            <h3 class="text-lg font-bold text-yellow-400 mb-4 border-b border-gray-600 pb-2">VIRTUAL KEYBOARD</h3>
            <div class="flex justify-center">
                <div class="relative flex" id="keyboard">
                    <!-- White keys -->
                    <div class="key white" data-note="C4" data-freq="261.63" style="width: 40px;"></div>
                    <div class="key black absolute" data-note="C#4" data-freq="277.18" style="left: 25px; width: 30px;"></div>
                    <div class="key white" data-note="D4" data-freq="293.66" style="width: 40px; margin-left: 0;"></div>
                    <div class="key black absolute" data-note="D#4" data-freq="311.13" style="left: 65px; width: 30px;"></div>
                    <div class="key white" data-note="E4" data-freq="329.63" style="width: 40px; margin-left: 0;"></div>
                    <div class="key white" data-note="F4" data-freq="349.23" style="width: 40px; margin-left: 0;"></div>
                    <div class="key black absolute" data-note="F#4" data-freq="369.99" style="left: 145px; width: 30px;"></div>
                    <div class="key white" data-note="G4" data-freq="392.00" style="width: 40px; margin-left: 0;"></div>
                    <div class="key black absolute" data-note="G#4" data-freq="415.30" style="left: 185px; width: 30px;"></div>
                    <div class="key white" data-note="A4" data-freq="440.00" style="width: 40px; margin-left: 0;"></div>
                    <div class="key black absolute" data-note="A#4" data-freq="466.16" style="left: 225px; width: 30px;"></div>
                    <div class="key white" data-note="B4" data-freq="493.88" style="width: 40px; margin-left: 0;"></div>
                    <div class="key white" data-note="C5" data-freq="523.25" style="width: 40px; margin-left: 0;"></div>
                </div>
            </div>
        </div>

        <!-- Master Controls -->
        <div class="panel p-6 rounded-lg box-glow">
            <h3 class="text-lg font-bold text-red-400 mb-4 border-b border-gray-600 pb-2">MASTER CONTROLS</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <label class="block text-sm text-gray-300 mb-2">VOLUME</label>
                    <div class="knob mx-auto" data-param="volume" data-value="75"></div>
                    <span class="block text-xs text-red-400 mt-1" id="volume-label">75%</span>
                </div>
                <div class="text-center">
                    <label class="block text-sm text-gray-300 mb-2">PITCH BEND</label>
                    <div class="knob mx-auto" data-param="pitchBend" data-value="0"></div>
                    <span class="block text-xs text-red-400 mt-1" id="pitch-label">0 ST</span>
                </div>
                <div class="text-center">
                    <label class="block text-sm text-gray-300 mb-2">MODULATION</label>
                    <div class="knob mx-auto" data-param="modulation" data-value="25"></div>
                    <span class="block text-xs text-red-400 mt-1" id="mod-label">25%</span>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Audio Engine
        class SynthEngine {
            constructor() {
                this.audioContext = null;
                this.masterGain = null;
                this.filter = null;
                this.convolver = null;
                this.delay = null;
                this.chorus = null;
                this.analyzer = null;
                this.oscilloscope = null;
                
                this.oscillators = new Map();
                this.currentWaveform = 'sine';
                this.noiseBuffer = null;
                
                this.envelope = {
                    attack: 0.1,
                    decay: 0.3,
                    sustain: 0.7,
                    release: 0.5
                };
                
                this.effects = {
                    reverb: 0.25,
                    delay: 0.15,
                    chorus: 0.35
                };
                
                this.init();
            }
            
            async init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    await this.setupAudioChain();
                    await this.createNoiseBuffer();
                    this.setupAnalyzer();
                    this.startVisualization();
                } catch (error) {
                    console.log('Audio initialization failed:', error);
                }
            }
            
            async setupAudioChain() {
                // Master gain
                this.masterGain = this.audioContext.createGain();
                this.masterGain.gain.value = 0.3;
                
                // Filter
                this.filter = this.audioContext.createBiquadFilter();
                this.filter.type = 'lowpass';
                this.filter.frequency.value = 1000;
                this.filter.Q.value = 1;
                
                // Effects
                await this.setupEffects();
                
                // Connect chain
                this.masterGain.connect(this.filter);
                this.filter.connect(this.convolver);
                this.convolver.connect(this.delay);
                this.delay.connect(this.chorus);
                this.chorus.connect(this.audioContext.destination);
            }
            
            async setupEffects() {
                // Reverb (Convolver)
                this.convolver = this.audioContext.createConvolver();
                this.dryGain = this.audioContext.createGain();
                this.wetGain = this.audioContext.createGain();
                
                const impulseBuffer = this.createImpulseResponse(2, 2);
                this.convolver.buffer = impulseBuffer;
                
                // Delay
                this.delay = this.audioContext.createDelay(1.0);
                this.delay.delayTime.value = 0.3;
                this.delayFeedback = this.audioContext.createGain();
                this.delayFeedback.gain.value = 0.3;
                this.delayMix = this.audioContext.createGain();
                this.delayMix.gain.value = 0.15;
                
                this.delay.connect(this.delayFeedback);
                this.delayFeedback.connect(this.delay);
                this.delay.connect(this.delayMix);
                
                // Chorus (simplified with LFO)
                this.chorus = this.audioContext.createGain();
                this.chorusDelay = this.audioContext.createDelay(0.05);
                this.chorusLFO = this.audioContext.createOscillator();
                this.chorusLFO.frequency.value = 0.5;
                this.chorusGain = this.audioContext.createGain();
                this.chorusGain.gain.value = 0.002;
                
                this.chorusLFO.connect(this.chorusGain);
                this.chorusGain.connect(this.chorusDelay.delayTime);
                this.chorusDelay.delayTime.value = 0.02;
                this.chorusLFO.start();
            }
            
            createImpulseResponse(duration, decay) {
                const sampleRate = this.audioContext.sampleRate;
                const length = sampleRate * duration;
                const impulse = this.audioContext.createBuffer(2, length, sampleRate);
                
                for (let channel = 0; channel < 2; channel++) {
                    const channelData = impulse.getChannelData(channel);
                    for (let i = 0; i < length; i++) {
                        channelData[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, decay);
                    }
                }
                return impulse;
            }
            
            async createNoiseBuffer() {
                const bufferSize = this.audioContext.sampleRate * 1; // 1 second of noise
                this.noiseBuffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const data = this.noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
            }
            
            setupAnalyzer() {
                this.analyzer = this.audioContext.createAnalyser();
                this.analyzer.fftSize = 256;
                this.analyzer.smoothingTimeConstant = 0.8;
                
                this.oscilloscope = this.audioContext.createAnalyser();
                this.oscilloscope.fftSize = 2048;
                
                this.chorus.connect(this.analyzer);
                this.chorus.connect(this.oscilloscope);
            }
            
            async ensureAudioContext() {
                if (this.audioContext && this.audioContext.state === 'suspended') {
                    await this.audioContext.resume();
                }
            }
            
            async playNote(frequency, duration = null) {
                await this.ensureAudioContext();
                
                if (this.oscillators.has(frequency)) {
                    return; // Note already playing
                }
                
                let oscillator;
                let gainNode = this.audioContext.createGain();
                
                if (this.currentWaveform === 'noise') {
                    oscillator = this.audioContext.createBufferSource();
                    oscillator.buffer = this.noiseBuffer;
                    oscillator.loop = true;
                } else {
                    oscillator = this.audioContext.createOscillator();
                    oscillator.type = this.currentWaveform;
                    oscillator.frequency.value = frequency;
                }
                
                // Apply envelope
                const now = this.audioContext.currentTime;
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(1, now + this.envelope.attack);
                gainNode.gain.linearRampToValueAtTime(this.envelope.sustain, now + this.envelope.attack + this.envelope.decay);
                
                oscillator.connect(gainNode);
                gainNode.connect(this.masterGain);
                
                oscillator.start();
                this.oscillators.set(frequency, { oscillator, gainNode });
                
                if (duration) {
                    setTimeout(() => this.stopNote(frequency), duration);
                }
                
                return { oscillator, gainNode };
            }
            
            stopNote(frequency) {
                const noteData = this.oscillators.get(frequency);
                if (!noteData) return;
                
                const { oscillator, gainNode } = noteData;
                const now = this.audioContext.currentTime;
                
                gainNode.gain.cancelScheduledValues(now);
                gainNode.gain.setValueAtTime(gainNode.gain.value, now);
                gainNode.gain.linearRampToValueAtTime(0, now + this.envelope.release);
                
                setTimeout(() => {
                    try {
                        oscillator.stop();
                    } catch (e) {}
                    this.oscillators.delete(frequency);
                }, this.envelope.release * 1000);
            }
            
            setWaveform(waveform) {
                this.currentWaveform = waveform;
            }
            
            setParameter(param, value) {
                if (!this.audioContext) return;
                
                switch (param) {
                    case 'frequency':
                        // Update all playing oscillators
                        this.oscillators.forEach(({ oscillator }) => {
                            if (oscillator.frequency) {
                                oscillator.frequency.value = value;
                            }
                        });
                        break;
                    case 'cutoff':
                        this.filter.frequency.value = value;
                        break;
                    case 'resonance':
                        this.filter.Q.value = value;
                        break;
                    case 'attack':
                        this.envelope.attack = value / 100;
                        break;
                    case 'decay':
                        this.envelope.decay = value / 100;
                        break;
                    case 'sustain':
                        this.envelope.sustain = value / 100;
                        break;
                    case 'release':
                        this.envelope.release = value / 100;
                        break;
                    case 'volume':
                        this.masterGain.gain.value = value / 100 * 0.3;
                        break;
                    case 'reverb':
                        this.effects.reverb = value / 100;
                        break;
                    case 'delay':
                        this.effects.delay = value / 100;
                        this.delayMix.gain.value = value / 100;
                        break;
                    case 'chorus':
                        this.effects.chorus = value / 100;
                        break;
                }
            }
            
            startVisualization() {
                const canvas = document.getElementById('oscilloscope-canvas');
                const ctx = canvas.getContext('2d');
                const dataArray = new Uint8Array(this.oscilloscope.frequencyBinCount);
                const spectrumArray = new Uint8Array(this.analyzer.frequencyBinCount);
                
                const draw = () => {
                    requestAnimationFrame(draw);
                    
                    // Oscilloscope
                    this.oscilloscope.getByteTimeDomainData(dataArray);
                    ctx.fillStyle = '#000';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = '#39ff14';
                    ctx.beginPath();
                    
                    const sliceWidth = canvas.width / dataArray.length;
                    let x = 0;
                    
                    for (let i = 0; i < dataArray.length; i++) {
                        const v = dataArray[i] / 128.0;
                        const y = v * canvas.height / 2;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                        x += sliceWidth;
                    }
                    
                    ctx.stroke();
                    
                    // Spectrum analyzer
                    this.analyzer.getByteFrequencyData(spectrumArray);
                    const bars = document.querySelectorAll('.spectrum-bar');
                    bars.forEach((bar, i) => {
                        const height = (spectrumArray[i] / 255) * 80 + 10;
                        bar.style.height = `${height}%`;
                    });
                };
                
                draw();
            }
        }
        
        // UI Sound Effects
        class UISounds {
            constructor(synthEngine) {
                this.synth = synthEngine;
            }
            
            playUISound(type) {
                const sounds = {
                    knob: () => this.synth.playNote(800 + Math.random() * 200, 50),
                    slider: () => this.synth.playNote(600 + Math.random() * 100, 30),
                    button: () => this.synth.playNote(1000 + Math.random() * 500, 80),
                    toggle: () => this.synth.playNote(1200, 60)
                };
                
                if (sounds[type]) {
                    sounds[type]();
                }
            }
        }
        
        // Initialize synthesizer
        const synth = new SynthEngine();
        const uiSounds = new UISounds(synth);
        
        // Generate spectrum analyzer bars
        function generateSpectrum() {
            const spectrum = document.getElementById('spectrum');
            for (let i = 0; i < 32; i++) {
                const bar = document.createElement('div');
                bar.className = 'spectrum-bar';
                bar.style.height = `${Math.random() * 80 + 10}%`;
                spectrum.appendChild(bar);
            }
        }
        
        // Handle knob interactions
        document.querySelectorAll('.knob').forEach(knob => {
            let isDragging = false;
            let startY = 0;
            let startValue = parseFloat(knob.dataset.value) || 0;
            const param = knob.dataset.param;
            
            const updateKnobValue = (value) => {
                knob.dataset.value = value;
                knob.style.transform = `rotate(${((value - 50) / 50) * 135}deg)`;
                
                // Update parameter
                if (param) {
                    let processedValue = value;
                    if (param === 'frequency') {
                        processedValue = 220 + (value / 100) * 880; // 220Hz to 1100Hz
                        document.getElementById('freq-label').textContent = `${Math.round(processedValue)} Hz`;
                        document.getElementById('frequency-display').textContent = `${Math.round(processedValue)} Hz`;
                    } else if (param === 'cutoff') {
                        processedValue = 100 + (value / 100) * 10000; // 100Hz to 10kHz
                        document.getElementById('cutoff-label').textContent = `${(processedValue / 1000).toFixed(1)} kHz`;
                    } else if (param === 'resonance') {
                        processedValue = 0.1 + (value / 100) * 29.9; // 0.1 to 30
                        document.getElementById('resonance-label').textContent = `${processedValue.toFixed(1)}`;
                    } else if (param === 'volume') {
                        document.getElementById('volume-label').textContent = `${Math.round(value)}%`;
                    } else if (param === 'pitchBend') {
                        processedValue = ((value - 50) / 50) * 12; // -12 to +12 semitones
                        document.getElementById('pitch-label').textContent = `${processedValue > 0 ? '+' : ''}${processedValue.toFixed(1)} ST`;
                    } else if (param === 'modulation') {
                        document.getElementById('mod-label').textContent = `${Math.round(value)}%`;
                    }
                    
                    synth.setParameter(param, processedValue);
                }
            };
            
            knob.addEventListener('mousedown', (e) => {
                isDragging = true;
                startY = e.clientY;
                startValue = parseFloat(knob.dataset.value) || 0;
                knob.classList.add('active');
                uiSounds.playUISound('knob');
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const deltaY = (startY - e.clientY) * 0.5;
                const newValue = Math.max(0, Math.min(100, startValue + deltaY));
                updateKnobValue(newValue);
            });
            
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    knob.classList.remove('active');
                }
            });
            
            // Initialize knob position
            const initialValue = parseFloat(knob.dataset.value) || 0;
            updateKnobValue(initialValue);
        });
        
        // Handle keyboard interactions
        document.querySelectorAll('.key').forEach(key => {
            const frequency = parseFloat(key.dataset.freq);
            
            const startNote = () => {
                key.classList.add('pressed', 'playing');
                synth.playNote(frequency);
                
                // Visual feedback
                const leds = document.querySelectorAll('.led');
                leds.forEach(led => {
                    led.classList.add('active');
                    setTimeout(() => led.classList.remove('active'), 150);
                });
            };
            
            const stopNote = () => {
                key.classList.remove('pressed', 'playing');
                synth.stopNote(frequency);
            };
            
            key.addEventListener('mousedown', startNote);
            key.addEventListener('mouseup', stopNote);
            key.addEventListener('mouseleave', stopNote);
            
            // Touch support
            key.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startNote();
            });
            
            key.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopNote();
            });
        });
        
        // Handle slider effects
        document.querySelectorAll('.slider').forEach(slider => {
            const param = slider.dataset.param;
            
            slider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                slider.classList.add('active');
                uiSounds.playUISound('slider');
                
                if (param) {
                    synth.setParameter(param, value);
                    
                    // Update effect LEDs
                    if (param === 'reverb') {
                        const led = document.getElementById('reverb-led');
                        if (value > 0) led.classList.add('active');
                        else led.classList.remove('active');
                    } else if (param === 'delay') {
                        const led = document.getElementById('delay-led');
                        if (value > 0) led.classList.add('active');
                        else led.classList.remove('active');
                    } else if (param === 'chorus') {
                        const led = document.getElementById('chorus-led');
                        if (value > 0) led.classList.add('active');
                        else led.classList.remove('active');
                    }
                }
                
                setTimeout(() => slider.classList.remove('active'), 200);
            });
            
            // Initialize effect LEDs
            if (param === 'reverb' && slider.value > 0) {
                document.getElementById('reverb-led').classList.add('active');
            } else if (param === 'delay' && slider.value > 0) {
                document.getElementById('delay-led').classList.add('active');
            } else if (param === 'chorus' && slider.value > 0) {
                document.getElementById('chorus-led').classList.add('active');
            }
        });
        
        // Handle waveform button selection
        document.querySelectorAll('.waveform-btn').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active state from siblings
                const siblings = button.parentElement.querySelectorAll('.waveform-btn');
                siblings.forEach(s => s.classList.remove('button-active'));
                button.classList.add('button-active');
                
                const waveform = button.dataset.waveform;
                synth.setWaveform(waveform);
                uiSounds.playUISound('button');
            });
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'a': 'C4', 'w': 'C#4', 's': 'D4', 'e': 'D#4', 'd': 'E4',
                'f': 'F4', 't': 'F#4', 'g': 'G4', 'y': 'G#4', 'h': 'A4',
                'u': 'A#4', 'j': 'B4', 'k': 'C5'
            };
            
            const note = keyMap[e.key.toLowerCase()];
            if (note && !e.repeat) {
                const key = document.querySelector(`[data-note="${note}"]`);
                if (key) {
                    key.dispatchEvent(new Event('mousedown'));
                }
            }
        });
        
        document.addEventListener('keyup', (e) => {
            const keyMap = {
                'a': 'C4', 'w': 'C#4', 's': 'D4', 'e': 'D#4', 'd': 'E4',
                'f': 'F4', 't': 'F#4', 'g': 'G4', 'y': 'G#4', 'h': 'A4',
                'u': 'A#4', 'j': 'B4', 'k': 'C5'
            };
            
            const note = keyMap[e.key.toLowerCase()];
            if (note) {
                const key = document.querySelector(`[data-note="${note}"]`);
                if (key) {
                    key.dispatchEvent(new Event('mouseup'));
                }
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            generateSpectrum();
            
            // Set SINE as default waveform
            document.querySelector('[data-waveform="sine"]').classList.add('button-active');
            
            // Initialize parameter values
            document.querySelectorAll('.slider').forEach(slider => {
                const param = slider.dataset.param;
                if (param) {
                    synth.setParameter(param, parseFloat(slider.value));
                }
            });
        });
        
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    
    <!-- Database Client Script -->
    <script src="db-client.js"></script>
</body>
</html>